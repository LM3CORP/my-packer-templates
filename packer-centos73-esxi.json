{
   "variables": {
        "puppet_rpm": "puppet-agent-1.7.1-1.el6.x86_64.rpm",
        "ssh_username": "root",
        "ssh_pass": "vagrant",
        "iso_url_prefix": "iso",
        "vm_version": "1.0",
        "vm_description": "Built with Packer VMware-Iso",
        "esxi_user": "",
        "esxi_pwd": "",
        "esxi_host": "",
        "esxi_datastore": ""
    },
   "provisioners": [
   {
      "type": "shell",
      "environment_vars": [ "PUPPET_RPM={{user `puppet_rpm`}}"
                          ],
      "execute_command": "echo '{{user `ssh_pass`}}' | {{.Vars}} sudo -S -E bash '{{.Path}}'",
      "scripts": [
          "scripts/centos/base/base.sh",
          "scripts/centos/base/sshd.sh",
          "scripts/centos/base/fix-slow-dns.sh"
         ]
   }
   ],
  "builders": [
  {
    "type": "vmware-iso",
    "name": "centos-73-x86_64",
    "vm_name": "centos73-vmware",
    "headless": true,
    "iso_url": "{{user `iso_url_prefix`}}/CentOS-7-x86_64-Minimal-1708.iso",
    "iso_checksum": "5848f2fd31c7acf3811ad88eaca6f4aa",
    "iso_checksum_type": "md5",
    "ssh_username": "{{user `ssh_username`}}",
    "ssh_password": "{{user `ssh_pass`}}",
    "ssh_wait_timeout": "90m",
    "http_directory" : "http",
    "output_directory": "packer-centos73-x86_64-vmware",
    "guest_os_type": "rhel7-64",
    "ssh_port": 22,
    "format": "ova",
    "boot_command": [
    "<tab> text ks=http://{{ .HTTPIP }}:{{ .HTTPPort }}/centos/7/ami/ks.cfg<enter><wait>"
    ],
    "remote_datastore": "{{user `esxi_datastore`}}",
    "remote_host": "{{user `esxi_host`}}",
    "remote_password": "{{user `esxi_pwd`}}",
    "remote_username": "{{user `esxi_user`}}",
    "remote_type": "esx5",
    "keep_registered": true,
    "tools_upload_flavor": "linux",
    "vmx_data": {
      "memsize": "2048",
      "numvcpus": "2",
      "ethernet0.present": "TRUE",
      "ethernet0.networkName":"Packer",
      "ethernet0.startConnected": "TRUE",
      "ethernet0.addressType": "generated",
      "ethernet0.generatedAddressOffset": "0",
      "ethernet0.wakeOnPcktRcv": "FALSE"
    },
    "shutdown_command": "echo {{user `ssh_pass`}} | sudo -S shutdown -P now"
    }],
    "post-processors" : [
     {
       "type": "vagrant",
       "keep_input_artifact": true,
       "output": "centos_73_{{.Provider}}.box"
     }
    ]
}
